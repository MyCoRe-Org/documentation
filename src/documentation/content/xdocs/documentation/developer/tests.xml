<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.2//EN" "http://apache.org/forrest/dtd/document-v12.dtd">
<document>
  <header>
    <title>Tests</title>
  </header>
  <body>
     <section>
        <title>Allgemeines</title>
        <p>
          Zur Gewährleistung einer Mindestqualität sind mit dem aktuellen Code-Stand je nach Entwicklungsstufe die
          nachfolgenden Tests durchzuführen. Voraussetzung für die Tests ist die Integration des JAI-Moduls in die
          Testumgebung, um auch Fehler im Bildbetrachter (ImageViewer) zu erkennen. Es wird vorausgesetzt, dass im
          Testsystem der vollständige aktuelle Codestand vorliegt. Nach jedem Arbeitsschritt ist zu prüfen, ob dieser
          erfolgreich und vollständig abgearbeitet wurde. Zur Kontrolle sollte der Log-Level auf DEBUG geschaltet werden
          und jede Kommandoausgabe in eine Datei geschrieben werden.
        </p>
      </section>
      <section>
        <title>Stufe 0 - Commit während einer Komponentenentwicklung</title>
        <ul>
          <li>Neues compilieren der MyCoRe-Kern Quellen mit vorherigem Löschen der alten Daten durch 'ant clean jar'.</li>
          <li>Neues Compilieren der DocPortal Quellen durch 'ant jar'.</li>
        </ul>
      </section>
      <section>
        <title>Stufe 1 – Bugfix</title>
        <ul>
          <li>Test der Stufe 0 durchführen</li>
          <li>Gefixte Komponenten und alle ggf. mit betroffenen Teile individuell testen.</li>
        </ul>
      </section>
      <section>
        <title>Stufe 2 - Komponente ist fertig entwickelt</title>
        <ul>
          <li>Test der Stufe 0 durchführen</li>
          <li>
            Vollständige Neuinstallation der DocPortal-Anwendung bis zur Betriebsbereitschaft mit vorherigem Löschen der
            alten Daten durch 'ant clean clean.data'. Dazu sind die folgenden Schritte auszuführen:
            <ul>
              <li>Anlegen der Verzeichnisse mit 'ant create.directories'.</li>
              <li>Erzeugen der XML-Schemas mit 'ant create.schema'.</li>
              <li>Neues compilieren der DocPortal Quellen durch 'ant jar'.</li>
              <li>Erzeugen der CLI-Scripts mit 'ant create.scripts'</li>
              <li>Starten der HSQLDB mit 'build/bin/hsqldbstart.sh' bzw. 'build\bin\hsqldbstart'.</li>
              <li>Test der Verbindung zur HSQLDB mit 'build/bin/hsqldbadmin.sh' bzw. 'build\bin\hsqldbadmin' (Server -
                localhost:8298).</li>
              <li>Start des CLI mit 'build/bin/mycore.sh' bzw. 'build\bin\mycore'. Prüfen mit 'help' ob alle CLI-Teile
                geladen wurden (z. B. Image-Kommandos).
              </li>
              <li>Laden der Standard-User mit 'ant create.users' (testet 'load permissions data from file ...', 'init
                superuser', 'change to user ...', 'create group data from file ...', 'create user data from file ...'
                und 'check user data consistency').</li>
              <li>Start des CLI mit 'build/bin/mycore.sh' bzw. 'build\bin\mycore'. Prüfen mit 'list all users' und 'list
                all groups' ob alle User-System-Teile vollständig geladen wurden.</li>
              <li>Laden der Klassifikationen mit 'ant create.class' (testet 'update all classifications from directory
                ...').</li>
              <li>
                Test der korrekten Installation der Klassifikationen mittels
                <em>select</em>
                -Statement über das hsqladmin-Tool.
              </li>
              <li>Erzeugen des Applet-Keys mit 'ant create.genkeys'.</li>
              <li>Erzeugen der Web-Applikation mit 'ant webapps'.</li>
              <li>Starten der Anwendung mit 'build/bin/jettystart.sh' bzw. 'build\bin\jettystart'.</li>
              <li>Aufruf von statischen Seiten, einer Suchmaske, einer Klassifikationsauswahl und dem Benutzerwechsel
                (wechseln zu author1A).</li>
            </ul>
          </li>
          <li>
            Laden und Testen der Standardbeispieldaten in die Anwendung. Diese stehen in der gesonderten
            MyCoRe-Komponente Content. Dazu sind die folgenden Schritte auszuführen:
            <ul>
              <li>Stoppen der Anwendung mit 'build/bin/jettystop.sh' bzw. 'build\bin\jettystop'.</li>
              <li>Laden der Institutionen mit 'ant load.institution' in content/defaultsample (testet 'update object
                from file ...').</li>
              <li>Laden der Autoren mit 'ant load.author' in content/defaultsample (testet 'update object from file
                ...').</li>
              <li>Laden der Dokumente mit 'ant load.document' in content/defaultsample (testet 'update object from file
                ...').</li>
              <li>Laden der Objekte mit 'ant load.derivate' in content/defaultsample (testet 'update derivate from file
                ...').</li>
              <li>Starten der Anwendung mit 'build/bin/jettystart.sh' bzw. 'build\bin\jettystart'.</li>
              <li>Test der Anwendung im Browser: Aufruf der Suche, Navigation in der Trefferliste, Anzeige von
                Einzeltreffern und Detaillisten. Suche nach Volltexten und Anzeige von Bildern mit dem ImageViewer.
                Navigation in Klassifikationen.</li>
              <li>Stoppen der Anwendung mit 'build/bin/jettystop.sh' bzw. 'build\bin\jettystop'.</li>
              <li>
                Test der Datensicherung mit 'build/bin/Save.sh' bzw 'build\bin\Save'. Prüfen der gespeicherten Daten im
                Verzeichnis <em>save</em> inklusive der korrekten ACLs (testet 'export object ... to directory ... with ...', 'export derivate ...
                to directory ... with ...', 'export all classifications to ... with ...', 'export all groups to file
                ...', 'export all users to file ...' und 'export all permissions to file ...'.
              </li>
            </ul>
          </li>
          <li>Intensiver Test der neuen Komponenten.</li>
          <li>Dokumentation der Komponente auf Vollständigkeit prüfen</li>
        </ul>
      </section>
      <section>
        <title>Stufe 3 - Release oder Snapshot</title>
        <p> Die Tests sind für Unix/Linux und Windows durchzuführen!</p>
        <ul>
          <li>Test der Stufe 1 durchführen</li>
          <li>Test des Commandline Interfaces</li>
          <li>Test der Web-Anwendung</li>
          <li>Test des WCMS</li>
          <li>Test sonstiger Funktionen</li>
        </ul>
        <section class="Test des Commandline Interfaces">
          <title>Test des Commandline Interfaces</title>
          <ul>
            <li>
              Tests des CLI (Nutzerverwaltung)
              <ul>
                <li>Start des CLI mit 'build/bin/mycore.sh' bzw. 'build\bin\mycore'.</li>
                <li>Login mit 'login administrator'.</li>
                <li>Sichern des Users author1A mit 'export user author1A to file author1A.xml'.</li>
                <li>Sichern des Users author1B mit 'export user author1B to file author1B.xml'.</li>
                <li>Sichern der Gruppe authorgroup1 mit 'export group authorgroup1 to file authorgroup1.xml'.</li>
                <li>Löschen einer Gruppe mit 'delete group authorgroup1'. Das Kommando darf NICHT funktionieren!</li>
                <li>Löschen eines Nutzers mit 'delete user author1A'.</li>
                <li>Löschen eines Nutzers mit 'delete user author1B'.</li>
                <li>Löschen einer Gruppe mit 'delete group authorgroup1'. Das Kommando muss jetzt funktionieren!</li>
                <li>Import der Gruppe authorgroup1 mit 'import group data from file authorgroup1.xml'.</li>
                <li>Import des Nutzers author1A mit 'import user data from file author1A.xml'.</li>
                <li>Import des Nutzers author1B mit 'import user data from file author1B.xml'.</li>
                <li>Test des Datenbestandes mit 'list all users' und 'list all groups'.</li>
                <li>Beenden des CLI mit 'quit'.</li>
              </ul>
            </li>
            <li>
              Tests des CLI (Klassifikationsverwaltung)
              <ul>
                <li>Start des CLI mit 'build/bin/mycore.sh' bzw. 'build\bin\mycore'.</li>
                <li>Sichern einer Klassifikation (ohne aktive Verweise) mit 'export classification
                  DocPortal_class_00000009 to . with save'</li>
                <li>Löschen einer referenzierten Klassifikation mit 'delete classification DocPortal_class_00000006'.
                  Das Kommando darf NICHT funktionieren!</li>
                <li>Löschen einer nicht referenzierten Klassifikation mit 'delete classification
                  DocPortal_class_00000009'. Das Kommando muss funktionieren!</li>
                <li>Laden der gespeicherten Klassifikation mit 'load classification from file
                  DocPortal_class_00000009.xml'.</li>
                <li>Update der gespeicherten Klassifikation mit 'update classification from file
                  DocPortal_class_00000009.xml'.</li>
                <li>Beenden des CLI mit 'quit'.</li>
              </ul>
            </li>
            <li>
              Tests des CLI (Rechteverwaltung)
              <ul>
                <li>Start des CLI mit 'build/bin/mycore.sh' bzw. 'build\bin\mycore'.</li>
                <li>Auflisten aller Permissions mit 'list all permissions'.</li>
                <li>Export aller Permissions mit 'export all permissions to file permission.xml' und prüfen der Ausgabe.</li>
                <li>
                  <code>[ToDo – 2007-08-29 – Jena ] Test der 'update permission'-Kommandos beschreiben</code>
                </li>
                <li>Beenden des CLI mit 'quit'.</li>
              </ul>
            </li>
            <li>
              Tests des CLI (Objekte und Derivate)
              <ul>
                <li>Start des CLI mit 'build/bin/mycore.sh' bzw. 'build\bin\mycore'.</li>
                <li>Anzeige der letzten verwendeten MCRObjectID mit 'get last ID for base DocPortal_document'. Es wird
                  'DocPortal_document_07910403' ausgegeben.</li>
                <li>Anzeige der nächsten MCRObjectID mit 'get next ID for base DocPortal_document'. Es wird
                  'DocPortal_document_07910404' ausgegeben.</li>
                <li>Reparieren der Indizes aller Dokumente mit 'repair metadata search of type document'.</li>
                <li>Reparieren des Dokuments DocPortal_document_07910403 mit 'repair metadata search of ID
                  DocPortal_document_07910403'.</li>
                <li>Reparieren des Derivate DocPortal_derivate_00410903 mit 'repair derivate search of ID
                  DocPortal_derivate_00410903'</li>
                <li>Löschen des Derivates DocPortal_derivate_00410902 mit 'delete derivate DocPortal_derivate_00410902'.</li>
                <li>Löschen des Objektes DocPortal_document_00410902 mit 'delete object DocPortal_document_00410902'.</li>
                <li>Löschen des Objektes DocPortal_document_00410901 mit 'delete object DocPortal_document_00410901'
                  (ohne vorherigem Löschen des Derivates).</li>
                <li>Prüfen der relevanten HSQLDB-Tabellen und des Lucene-Eintrages.</li>
                <li>Beenden des CLI mit 'quit'.</li>
              </ul>
            </li>
          </ul>
        </section>
        <section>
          <title>Test der Web-Anwendung</title>
          <ul>
            <li>Starten der Anwendung mit 'build/bin/jettystart.sh' bzw. 'build\bin\jettystart'.</li>
            <li>
              Tests der Web-Anwendung (statische Seiten)
              <ul>
                <li>Es sind alle Seiten der sitemap.xml Anzeige durchzutesten.</li>
              </ul>
            </li>
            <li>
              Tests der Web-Anwendung (Suche/Präsentation/Navigation)
              <ul>
                <li>Suche nach Institutionen</li>
                <li>Suche nach Personen, weiter Suchen nach verlinkten Dokumenten</li>
                <li>Suche nach Dokumenten ohne Parameter und Navigation in der Trefferliste. Navigation aus der Anzeige
                  heraus zur Trefferliste und zur Detailansicht. Anzeige von Dokumenten mit Bildern (bei integriertem
                  ImageViewer).</li>
                <li>Suche nach Dokumenten mit Parametern und Volltextsuchbegriffen, z. B. 'Hühnerstall', 'Huhn*', usw.</li>
                <li>Test der Zugriffsrechte auf Objekte mit Wechsel der User (z. B. Suche nach 'Umbau').</li>
                <li>Navigation über den Personenindex und von dort zu Dokumenten (z. B. Trappe).</li>
                <li>Navigation in den Klassifikationen (z. B. Herkunft, Format).</li>
              </ul>
            </li>
            <li>
              Tests der Web-Anwendung (Editor-Funktionen)
              <ul>
                <li>Login als User 'author1A'.</li>
                <li>Neuanlegen einer Institution, Bearbeiten der Daten im Workflow, Löschen der Institution aus dem
                  Workflow.</li>
                <li>Neuanlegen einer Institution, ändern der ACLs (mehrer Versionen durchspielen), Hochladen der
                  Institution, Bearbeiten der Daten, Suchen nach den Daten und Löschen der Daten aus dem Server.</li>
                <li>Neuanlegen einer Person, Bearbeiten der Daten im Workflow, Löschen der Institution aus dem Workflow.</li>
                <li>Neuanlegen einer Person, ändern der ACLs (mehrer Versionen durchspielen), Hochladen der Person,
                  Bearbeiten der Daten, Suchen und Navigieren nach den Daten, Setzen der ACL-Permission 'deletedb' für
                  'author1A' und Löschen der Daten aus dem Server.</li>
                <li>Neuanlegen eines Dokuments (mit Link auf einen Personendatensatz), Bearbeiten der Daten im Workflow,
                  Hinzufügen eines Derivates, Hinzufügen einer Datei zum Derivate, Umbenennen des Derivates und Löschen
                  des Dokuments aus dem Workflow.</li>
                <li>Neuanlegen eines Dokuments (mit Link auf einen Personendatensatz), Hochladen des Dokuments,
                  Bearbeiten der Daten, Hinzufügen eines Derivates, Hinzufügen einer Datei zum Derivate, Umbenennen des
                  Derivates, Löschen einer Datei aus dem Derivate und Löschen des Dokuments aus dem Server.</li>
                <li>Logout als 'gast'</li>
              </ul>
            </li>
            <li>
              Tests der Web-Anwendung (Klassifikationseditor)
              <ul>
                <li>Login als User 'administrator'.</li>
                <li>Auswahl Menüpunkt Klassifikationseditor starten.</li>
                <li>Neue Klassifikation erstellen (ID DocPortal_class_00000100), Klassifikation speichern,
                  Klassifikationsbeschreibung ändern, zwei neue Kategorien hinzufügen, Reihenfolge tauschen, Kategorie
                  editieren, 'empty' Kategorie löschen, Klassifikation speichern, exportieren und wieder löschen.</li>
                <li>Logout als 'gast'.</li>
                <li>Navigation in den Klassifikationen.</li>
              </ul>
            </li>
            <li>
              Tests der Web-Anwendung (Nutzerverwaltung)
              <ul>
                <li>Aufruf Startseite, Aufruf Login als anderer User, 'Abbrechen', Aufruf Login als anderer User, Login
                  als User 'administrator', Rückkehr zur Anwendung, Benutzer wechseln -&gt; 'Abbrechen', Benutzer
                  abmelden.</li>
                <li>Login als User 'administrator' und Rückkehr zur Anwendung.</li>
                <li>Passwort ändern und 'Abbrechen' drücken.</li>
                <li>Passwort ändern und 'Ändern' drücken. Login mit dem neuen Passwort.</li>
                <li>Benutzerdaten anzeigen lassen.</li>
                <li>Neue Gruppe 'test' anlegen, Gruppe administrieren und 2 Benutzer 'test' zuweisen. Neuen Benutzer
                  'otto' für die Gruppe 'test' anlegen.</li>
                <li>Logout als 'gast'.</li>
              </ul>
            </li>
            <li>
              Tests der Web-Anwendung (ACL-Editor)
              <ul>
                <li>Login als User 'administrator'.</li>
                <li>ACL-Editor starten, nach MCRObjectID DocPortal_author_00410901 filtern, 'writedb' auf
                  'SYSTEMRULE000000006' setzen, OK, Logout als 'gast', Suche nach Person 'Kupferschmidt' – muss jetzt
                  von 'gast' editierbar sein.</li>
                <li>Login als User 'administrator'.</li>
                <li>ACL-Editor starten, Rule-Editor aufrufen, 'SYSTEMRULE0000000002' um Gruppe 'test' erweitern, OK.
                  Login as 'test' ant try to change sample data.</li>
                <li>Logout als 'gast'.</li>
              </ul>
            </li>
            <li>
              Tests der Web-Anwendung (Broadcasting Modul)
              <ul>
                <li>Login als User 'administrator'</li>
                <li>Module-Broadcasting Monitoring -&gt; edit, 'Power' -&gt; on, ' Message Header' und 'Message Tail'
                  ausfüllen, 'Nachricht an Gruppe' -&gt; admingroup -&gt; ...text... , OK. Login als User
                  'administrator' (sollte Nachricht erhalten).</li>
                <li>Module-Broadcasting Monitoring -&gt; edit, 'Power' -&gt; off</li>
              </ul>
            </li>
            <li>
              Tests der Web-Anwendung (WebCLI Module)
              <ul>
                <li>Starten des Web-Commandline-Interfaces</li>
                <li>Auswählen von Kommandos wie 'list all users' und kritsches prüfen des Ergebnisses</li>
                <li>Web-Commandline-Interfaces schließen</li>
                <li>Login als gast und erneuter Versuch, das Tool zu starten (darf nicht gehen).</li>
              </ul>
            </li>
            <li>Stoppen der Anwendung mit 'build/bin/jettystop.sh' bzw. 'build\bin\jettystop'.</li>
          </ul>
        </section>
        <section>
          <title>Test des WCMS</title>
          <ul>
            <li>
              <code>[ToDo – 2007-08-29 – Jena]</code>
            </li>
          </ul>
        </section>
        <section>
          <title>Test sonstiger Funktionen</title>
          <ul>
            <li>
              Test Google-Servlet
              <ul>
                <li>
                  Aufruf von
                  <a href="http://localhost:8291/sitemap_google.xml">http://localhost:8291/sitemap_google.xml</a>,
                  es sollte eine korrekte Sitemap zurückgeliefert werden.
                </li>
              </ul>
            </li>
            <li>
              Test OAI
              <ul>
                <li>
                  <code>[ToDo – 2007-09-25 - Rostock]</code>
                </li>
              </ul>
            </li>
            <li>
              Test Z3950
              <ul>
                <li>
                  <code>[ToDo – 2007-09-25 - Rostock]</code>
                </li>
              </ul>
            </li>
            <li>
              Test MyCoRe Remote Access
              <ul>
                <li>Starten der Anwendung mit 'build/bin/jettystart.sh' bzw. 'build\bin\jettystart'.</li>
                <li>ant webservice.deploy</li>
                <li>Suchmaske nach Dokumenten aufrufen, 'diesem und ausgewählten Servern' sowie 'Lokal via WebService'
                  und 'DocPortal Sample Server' markieren und die Suche starten. Es müssen die Beispieldaten je dreimal
                  als Treffer erscheinen. Navigation in den Treffern testen.</li>
                <li>Stoppen der Anwendung mit 'build/bin/jettystop.sh' bzw. 'build\bin\jettystop'.</li>
              </ul>
            </li>
            <li>
              Test der Vererbung
              <ul>
                <li>
                  <code>[ToDo – 2007-09-25 - Leipzig]</code>
                </li>
              </ul>
            </li>
          </ul>
        </section>
      </section>
      <section>
        <title>Test der Distribution</title>
        <p>
          <strong>Die Tests sind für Unix/Linux und Windows durchzuführen!</strong>
        </p>
        <ul>
          <li>Test der Installation des Basispaketes</li>
          <li>Test der Installation der Content-Pakete</li>
          <li>Test gemäß Punkt 'Test der Web-Anwendung'</li>
          <li>Test des Entfernens der Distribution</li>
        </ul>
      </section>
      <section>
        <title>Selenium-Tests</title>
        <pre>
Am einfachsten ist es wohl man macht einfach das was Jenkins auch macht,
ein Durchlauf via ant

ant -k download configure start.hsqldb load.data build.webapp
start.jetty selenium stop.jetty stop.hsqldb check

Das ant target "selenium" lässt die Tests gegen ein lokales Jetty
laufen. Die Tests liegen in docportal/test/selenium/ und sind an sich
einfache HTML-Seiten.

Die Testergebnisse sind wiederum HTML-Seiten

http://www.mycore.de/jenkins/job/DocPortal/seleniumhq/
bzw.
docportal/build/test/selenium-results.html

Damit selenium lokal läuft muss es in der Lage sein im
Hintergrund einen firefox zu starten.

Das hat z.B.
JAVA_OPTS=-Djava.awt.headless=true
erfordert, und die Installation von Xvfb, weil der Server kein X11
Display hat.

Das ist hier beschrieben, aber da steht eher zu viel

http://wiki.openqa.org/display/SRC/Selenium-RC+and+Continuous+Integration

Man sollte die Tests auch einfach laufen lassen können, wenn man das
Selenium-Plugin für Firefox installiert

http://seleniumhq.org/
        </pre>
      </section>
  </body>
</document>